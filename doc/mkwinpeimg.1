.TH MKWINPEIMG "1" "May 2012" "mkwinpeimg (wimlib 0.6.3)" "User Commands"
.SH NAME
mkwinpeimg \- Make a customized bootable image of Windows PE
.SH SYNOPSIS
.B mkwinpeimg
[\fIOPTIONS\fR] \fIIMAGE\fR

.SH DESCRIPTION

\fBmkwinpeimg\fR is able to make a bootable image of Windows PE by taking files
from a mounted Windows DVD (Windows 7 or Windows 8) or the mounted ISO image for
the Windows Automated Installation Kit (WAIK).  The \fB--windows-dir\fR and
\fB--waik-dir\fR options are used to specify the locations of these mounted
ISOs.  You only need one or the other.  The files that \fBmkwinpeimg\fR will
retrieve are \fIboot.wim\fR, \fIbootmgr\fR, \fIboot.sdi\fR, and \fIbcd\fR.  If
making an ISO image, the file \fIetfsboot.com\fR is also retrieved.  Microsoft
owns the rights to these files and they are not distributed with WIMLIB.

\fBmkwinpeimg\fR can currently make two types of bootable images.  The default
is to make a bootable disk image.  The image is not partitioned and is formatted
into a FAT filesystem.  \fBsyslinux\fR(1) is required to make this type of
image, as it is used to chainload \fIbootmgr\fR. Also, \fBmtools\fR(1) is
required so that the FAT filesystem can be created without root privileges.

The other type of bootable image that \fBmkwinpeimg\fR can make is a bootable
ISO image.  To make this type of image, give the \fB--iso\fR option.
\fBmkisofs\fR(1) is required to make this type of image.

If you make a disk image, you could put it on a USB drive, and if you make an
ISO image, you could put it on a CD.  In addition, both types of images can be
loaded by the SYSLINUX or PXELINUX bootloaders using the MEMDISK module.

Windows PE itself is contained in the \fIboot.wim\fR file.  \fBmkwinpeimg\fR can
modify this file before embedding it in a bootable image.  The most useful
modification is to specify an executable or batch file for Windows PE to execute
as soon as it starts up.  Use the \fB--start-script\fR \fIFILE\fR option to
specify such a file.  You may also add arbitrary files to \fIboot.wim\fR by
putting them in a directory, then specifying the \fB--overlay\fR \fIDIR\fR
option.

\fBmkwinpeimg\fR can also make only a modified \fIboot.wim\fR, rather than a
bootable ISO or disk image, if the \fB--only-wim\fR option is given.

The Windows PE WIMs provided in Windows 7, Windows 8, and the WAIK are not the
same, but are all similar.  The best one to use is likely the one from the WAIK,
as that one is the smallest.

.SH OPTIONS

.TP
\fB\-i\fR, \fB\-\-iso\fR
Make an ISO image instead of a disk image.
.TP
\fB\-o\fR, \fB\-\-only-wim\fR
Make neither a disk image nor an ISO image; instead, only make a modified
\fIboot.wim\fR file.
.TP
\fB\-W\fR, \fB\-\-windows\-dir\fR=\fIDIR\fR
Use DIR as the location of the mounted Windows 7 or Windows 8 DVD.  Default is
/mnt/windows, then /mnt/windows7, then /mnt/windows8.
.TP
\fB\-A\fR, \fB\-\-waik\-dir\fR=\fIDIR\fR
Get the boot files and boot.wim from the ISO of the Windows Automated
Installation Kit mounted on DIR instead of from the Windows 7 or Windows 8 DVD.
.TP
\fB\-s\fR, \fB\-\-start\-script\fR=\fIFILE\fR
Add FILE to the root directory of Windows PE image and adjust
\eWindows\eSystem32\ewinpeshl.ini to execute FILE when Windows PE starts up.
.TP
\fB\-w\fR, \fB\-\-wim\fR=\fIWIM\fR
Use WIM as the "boot.wim" file.  Defaults to "sources/boot.wim" in the Windows DVD
directory, or F1_WINPE.WIM from the WAIK if \fB\-\-waik\-dir\fR is specified.
.TP
\fB\-O\fR, \fB\-\-overlay\fR=\fIDIR\fR
Adds all the files in DIR to the Windows PE image.
.TP
\fB\-t\fR, \fB\-\-tmp\-dir\fR=\fIDIR\fR
Use DIR for temporary files.  Defaults to a directory made using \e"mktemp
\fB\-d\fR\e".
.TP
\fB\-h\fR, \fB\-\-help\fR
Display help.
.TP
\fB\-v\fR, \fB\-\-version\fR
Show version information.
.SH EXAMPLES

.IP 
mkwinpeimg --windows-dir=/media/windows winpe.img
.LP
Create a bootable disk image of Windows PE from the Windows DVD mounted on
/media/windows.

.IP
mkwinpeimg --iso --waik-dir=/media/waik --overlay=winpe_overlay winpe.iso
.LP
Create a bootable ISO of Windows PE from the WAIK mounted on /media/waik, and
add all the files in "winpe_overlay" to Windows PE's filesystem.

.IP
mkwinpeimg --start-script=install.cmd --windows-dir=/media/windows /var/tftpboot/winpe.img
.LP

Create a bootable image of Windows PE from the Windows DVD mounted on
/media/windows, add and make it execute "install.cmd" when it starts up.  In
this example the image is created in the root directory of the TFTP server for
network booting.

.SH NOTES

Microsoft's licenses may limit the things that Windows PE can be used for, and
they may limit your rights to redistribute customized versions of Windows PE.

.SH REPORTING BUGS

Report bugs to ebiggers3@gmail.com.

.SH SEE ALSO
.BR imagex (1)
