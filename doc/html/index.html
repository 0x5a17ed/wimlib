<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>wimlib: Main Page</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">wimlib
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">wimlib Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="intro"></a>
Introduction</h2>
<p>wimlib is a C library to read, write, and mount archive files in the Windows Imaging Format (WIM files). These files are normally created using the <code>imagex.exe</code> utility on Windows, but this library provides a free implementetion of <code>imagex</code> for UNIX-based systems and an API to allow other programs to read, write, and mount WIM files. wimlib is comparable to Microsoft's WIMGAPI, but was designed independently and is not a clone of it.</p>
<p>The main intended use of wimlib is to create customized images of Windows PE, the Windows Preinstallation Environment, without having to rely on Windows. Windows PE, which is the operating system that runs when you boot from the Windows Vista or Windows 7 DVD, is a lightweight version of Windows that can run entirely from memory. It can be used to install Windows from local media or a network drive or perform maintenance.</p>
<p>You can find Windows PE on the installation media for Windows Vista, Windows 7, and Windows 8. The Windows PE image itself is a WIM file, <code>sources/boot.wim</code>, on the ISO filesystem. Windows PE can also be found in the Windows Automated Installation Kit (WAIK) inside the <code>WinPE.cab</code> file, which you can extract if you install the <code>cabextract</code> program.</p>
<h2><a class="anchor" id="format"></a>
WIM files</h2>
<p>A <b>Windows Imaging (WIM)</b> file is an archive. Like some other archive formats such as ZIP, files in WIM archives may be compressed. WIM archives support two Microsoft-specific compression formats: <b>LZX</b> and <b>XPRESS</b>. Both are based on LZ77 and Huffman encoding, and both are supported by wimlib.</p>
<p>Unlike ZIP files, WIM files can contain multiple independent toplevel directory trees known as <em>images</em>. While each image has its own metadata, files are not duplicated for each image; instead, each file is included only once in the entire WIM. Microsoft did this so that in one WIM file, they could do things like have 5 different versions of Windows that are almost exactly the same.</p>
<p>WIM files may contain a integrity table. The integrity table, if it exists, is located at the end of the WIM file and contains SHA1 message digests of 10MB chunks of the WIM.</p>
<p>Microsoft provides documentation for the WIM file format, XPRESS compression format, and LZX compression format. However, there are errors and omissions in some places in their documentation.</p>
<h2><a class="anchor" id="starting"></a>
Getting Started</h2>
<p>wimlib uses the GNU autotools, so it should be easy to install with <code>configure &amp;&amp; make &amp;&amp; sudo make install</code>, provided that you have <code>libxml2</code> and <code>libfuse</code> installed. To use wimlib in a program after installing it, include <code><a class="el" href="wimlib_8h.html">wimlib.h</a></code> and link your program with <code>-lwim</code>.</p>
<p>wimlib wraps up a WIM file in an opaque <a class="el" href="wimlib_8h.html#a8d4f2d1c1110b4519054e55d26b73775" title="Opaque structure that represents a WIM file.">WIMStruct</a> structure.</p>
<p>All functions in wimlib's public API are prefixed with <code>wimlib</code>. Most return an integer error code on failure. Use <a class="el" href="wimlib_8h.html#a4cad466851acb2f24ba4af35b27003b7" title="Converts an error code into a string describing it.">wimlib_get_error_string()</a> to get a string that describes an error code. wimlib also can print error messages itself when an error happens, and these may be more informative than the error code; to enable this, call <a class="el" href="wimlib_8h.html#a49c39d3c9aa74ac63e1f97da97c20959" title="Sets whether wimlib is to print error messages to stderr when a function fails or not...">wimlib_set_print_errors()</a>.</p>
<p>wimlib is thread-safe as long as different <a class="el" href="wimlib_8h.html#a8d4f2d1c1110b4519054e55d26b73775" title="Opaque structure that represents a WIM file.">WIMStruct</a>'s are used, with the following exceptions: <a class="el" href="wimlib_8h.html#a49c39d3c9aa74ac63e1f97da97c20959" title="Sets whether wimlib is to print error messages to stderr when a function fails or not...">wimlib_set_print_errors()</a> and <a class="el" href="wimlib_8h.html#a956a20eabacceda5230e346ee5cd387f" title="Set the functions that wimlib uses to allocate and free memory.">wimlib_set_memory_allocator()</a> apply globally, and <a class="el" href="wimlib_8h.html#aa6c0a2c2b896530718bd23e433b07e46" title="Mounts an image in a WIM file on a directory read-only or read-write.">wimlib_mount()</a> can only be used by one <a class="el" href="wimlib_8h.html#a8d4f2d1c1110b4519054e55d26b73775" title="Opaque structure that represents a WIM file.">WIMStruct</a> at a time.</p>
<p>To open an existing WIM, use <a class="el" href="wimlib_8h.html#a16e1b87c7ab9eeadc0523a2477bfb0f6" title="Opens a WIM file and creates a WIMStruct for it.">wimlib_open_wim()</a>.</p>
<p>To create a new WIM that initially contains no images, use <a class="el" href="wimlib_8h.html#a75acbea33e2faf398d58865fb764b91e" title="Creates a WIMStruct for a new WIM file.">wimlib_create_new_wim()</a>.</p>
<p>To add an image to a WIM file from a directory tree on your filesystem, call <a class="el" href="wimlib_8h.html#a27ff93a6c6e9df370a6aa1eff753bb43" title="Adds an image to a WIM file from a directory tree on disk.">wimlib_add_image()</a>. This can be done with a <a class="el" href="wimlib_8h.html#a8d4f2d1c1110b4519054e55d26b73775" title="Opaque structure that represents a WIM file.">WIMStruct</a> gotten from <a class="el" href="wimlib_8h.html#a16e1b87c7ab9eeadc0523a2477bfb0f6" title="Opens a WIM file and creates a WIMStruct for it.">wimlib_open_wim()</a> or from <a class="el" href="wimlib_8h.html#a75acbea33e2faf398d58865fb764b91e" title="Creates a WIMStruct for a new WIM file.">wimlib_create_new_wim()</a>.</p>
<p>To extract an image from a WIM file, call <a class="el" href="wimlib_8h.html#ab2a5fd17df52da1517835a05ee9b4965" title="Sets and creates the directory to which files are to be extracted when extracting files from the WIM...">wimlib_set_output_dir()</a> to set the output directory, then call <a class="el" href="wimlib_8h.html#a6a681ff211ec60f05a6ac5f743b17f65" title="Extracts an image, or all images, from a WIM file.">wimlib_extract_image()</a>.</p>
<p>wimlib supports mounting WIM files either read-only or read-write. Mounting is done using <a class="el" href="wimlib_8h.html#aa6c0a2c2b896530718bd23e433b07e46" title="Mounts an image in a WIM file on a directory read-only or read-write.">wimlib_mount()</a> and unmounting is done using <a class="el" href="wimlib_8h.html#a2e0ba93652ac9372b56f9a67e3dbf1a1" title="Unmounts a WIM image that was mounted using wimlib_mount().">wimlib_unmount()</a>. Mounting can be done without root privileges because it is implemented using FUSE (Filesystem in Userspace). If wimlib is compiled with the <code>--without-fuse</code> flag, these functions will be available but will fail.</p>
<p>After creating or modifying a WIM file, you can write it to a file using <a class="el" href="wimlib_8h.html#a968b46d4decee0ff73504ad9b212734e" title="Writes the WIM to a file.">wimlib_write()</a>. Alternatively, if the WIM was originally read from a file, you can use <a class="el" href="wimlib_8h.html#ab8648f8386379f2b2930b877e4efd6ca" title="Overwrites the file that the WIM was originally read from, with changes made.">wimlib_overwrite()</a> to overwrite the original file. In some cases, <a class="el" href="wimlib_8h.html#aec658496a01b1ca9dfd97eb9b9a92bb8" title="Updates the header and XML data of the WIM file, without the need to write out the entire WIM to a te...">wimlib_overwrite_xml_and_header()</a> can be used instead.</p>
<p>After you are done with the WIM file, use <a class="el" href="wimlib_8h.html#a36a722a1651ff46b2f5a11a445c6fd73" title="Frees all memory allocated for a WIMStruct and closes all files associated with it.">wimlib_free()</a> to free all memory associated with a <a class="el" href="wimlib_8h.html#a8d4f2d1c1110b4519054e55d26b73775" title="Opaque structure that represents a WIM file.">WIMStruct</a> and close all files associated with it.</p>
<p>To see an example of how to use wimlib, see the file <code>programs/imagex.c</code> in wimlib's source tree.</p>
<p>wimlib supports custom memory allocators; use <a class="el" href="wimlib_8h.html#a956a20eabacceda5230e346ee5cd387f" title="Set the functions that wimlib uses to allocate and free memory.">wimlib_set_memory_allocator()</a> for this.</p>
<h2><a class="anchor" id="imagex"></a>
imagex</h2>
<p>wimlib comes with the <b>imagex</b> program, which is documented in man pages.</p>
<h2><a class="anchor" id="mkwinpeimg"></a>
mkwinpeimg</h2>
<p>wimlib comes with the <b>mkwinpeimg</b> script, which is documented in a man page.</p>
<h2><a class="anchor" id="Limitations"></a>
Limitations</h2>
<p>While wimlib supports the main features of WIM files, wimlib currently has the following limitations:</p>
<ul>
<li>wimlib does not support "security data", which describes the access rights of the files in the WIM. This data is very Windows-specific, and it would be difficult to do anything with it. Microsoft's software can still read a WIM without security data, including a boot.wim for Windows PE, but <b>do not expect to be able to use wimlib to image a Windows installation and preserve file attributes</b>.</li>
<li>There is no support for split WIMs, which have an image divided up between multiple WIM files.</li>
<li>There is not yet any code to verify that there are no collisions between different files that happen to have the same SHA1 message digest. This is extremely unlikely, but could result in something bad such as a file going missing.</li>
<li>Alternate stream entries for directory entries are ignored. I'm not sure if these are ever used for anything important.</li>
<li>Different versions of the WIM file format, if they even exist, are unsupported. Let me know if you notice WIM files with a different version.</li>
<li>Chunk sizes other than 32768 are unsupported (except for uncompressed WIMs, for which the chunk size field is ignored). As far as I can tell, other chunk sizes are not used in compressed WIMs. Let me know if you find a WIM file with a different chunk size.</li>
<li>wimlib does not provide a clone of the <b>PEImg</b> tool that allows you to make certain Windows-specific modifications to a Windows PE image, such as adding a driver or Windows component. Such a tool could conceivably be implemented on top of wimlib, although it likely would be hard to implement because it would have to do very Windows-specific things such as manipulating the driver store. wimlib does provide the <b>mkwinpeimg</b> script for a similar purpose, however. With regards to adding drivers to Windows PE, you have the option of putting them anywhere in the Windows PE image, then loading them after boot using <b>drvload.exe</b>.</li>
<li>There is not yet a way to extract specific files or directories from a WIM file without mounting it, or to add, remove, or modify files in a WIM without mounting it, other than by adding or removing an entire image. I can implement this if requested, but I intend the FUSE mount feature to be used for this purpose, as it is easy to do these things in whatever way you want after the image is mounted.</li>
</ul>
<p>Currently, Microsoft's <em>image.exe</em> can create slightly smaller WIM files than wimlib when using maximum (LZX) compression because it knows how to split up LZX compressed blocks, which is not yet implemented in wimlib.</p>
<p>wimlib is experimental and likely contains bugs; use Microsoft's <em>imagex.exe</em> if you want to make sure your WIM files are made correctly.</p>
<h2><a class="anchor" id="legal"></a>
License</h2>
<p>The wimlib library is licensed under the GNU Lesser General Public License version 2.1 or later.</p>
<p><b>imagex</b> and <b>mkwinpeiso</b> are licensed under the GNU General Public License version 3 or later. </p>
</div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.0
</small></address>

</body>
</html>
